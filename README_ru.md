# Онлайн-сервис агрегатора подписок

Проект реализует REST‑сервис для хранения и агрегирования данных об
онлайн‑подписках пользователей.\
Сервис предоставляет CRUD‑операции над записями, а также вычисление
суммарной стоимости подписок за выбранный период.

## Функциональность

### 1. CRUD‑операции над подписками

Каждая подписка содержит: - название сервиса; - стоимость в рублях; -
UUID пользователя; - дату начала (месяц--год); - дату окончания
(опционально).

Доступные методы: - **POST /subscriptions** --- создание подписки\
- **GET /subscriptions/{id}** --- получение по ID\
- **PUT /subscriptions/{id}** --- обновление\
- **DELETE /subscriptions/{id}** --- удаление\
- **GET /subscriptions?user_id=...** --- список подписок пользователя

### 2. Подсчёт суммы подписок

    GET /subscriptions/sum?user_id=...&service_name=...&from=MM-YYYY&to=MM-YYYY

Расчёт учитывает полный месяц и корректно обрабатывает пересечения
периодов.

## Стек технологий

-   **Go 1.24**
-   **Chi** --- HTTP‑роутер
-   **PostgreSQL 17**
-   **golang-migrate** --- миграции
-   **Zap** --- логирование
-   **Docker + Docker Compose**
-   **Swagger (swaggo)** --- автодокументация API

## Архитектура проекта

Проект разбит на логические слои:

-   **handlers** --- HTTP‑обработчики, работа с запросом/ответом\
-   **service** --- бизнес‑логика (валидация, расчёты, правила)\
-   **storage** --- слой работы с PostgreSQL\
-   **models** --- структурные модели\
-   **migrations** --- SQL‑миграции\
-   **docs** --- Swagger‑описание API

Такое разделение упрощает тестирование и поддержку.

## Данные и структура таблиц

Таблица `subscriptions`:

``` sql
CREATE TABLE IF NOT EXISTS subscriptions (
    id SERIAL PRIMARY KEY,
    service_name TEXT NOT NULL,
    price INT NOT NULL,
    user_id UUID NOT NULL,
    start_date DATE NOT NULL,
    end_date DATE
);
```

## Миграции

Миграции выполняются автоматически при запуске приложения.\
Каталог: `migrations/`

## Запуск через Docker

``` bash
docker compose up --build
```

Сервис будет доступен по адресу:

    http://localhost:8080

## Swagger документация

После запуска открыть:

    http://localhost:8080/swagger/index.html

## Переменные окружения

Используется файл `.env`:

    SERVER_ADDR=:8080
    DATABASE_DSN=postgres://subs_user:subs_pass@db:5432/subscriptions?sslmode=disable

## Тесты

В проекте реализованы: - юнит‑тесты сервисного слоя, - тесты хендлеров
через httptest.

Запуск:

``` bash
go test ./...
```

## Статус реализации ТЗ

Все требования тестового задания выполнены: - CRUD готов\
- подсчёт суммы за период реализован\
- PostgreSQL + миграции подключены\
- логирование через middleware\
- Docker‑сборка создана\
- Swagger документация актуальна

Проект соответствует уровню junior+/middle и готов к использованию.
